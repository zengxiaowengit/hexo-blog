---
title: CAS操作与volatile
date: 2018-01-25 09:53:54
tags:
	- 并发
---

## 简介
	
	CAS是什么？
	英文翻译是CompareAndSet或者（CompareAndSwap）。因为并发标志是在0和1之间抓换，所以叫比较-交换或者比较-设值都可以。
	

	以原子的方式更新这个更新器所管理的对象(obj)的成员变量，并且将这个成员变量更新为给定的更新后的值(update)如果当前值等于期望值(expect)时。
    
    当存在其他使用‘compareAndSet’或者’set’的情况下，这个方法可以确保是原子的。
    
    但如果你用其他的方式去改变这个成员变量时(如，使用直接赋值的方式 field=newField)，那么它是不会遵循这个原子性的。
    
    JDK中使用这种思想来确保并发的同步操作。如：ConcurrentHashMap。

## CAS带来的ABA问题
	
	
	

## volatile
	
	volatile关键字主要是保证了编译器在做指令优化的时候，不会对加了改关键字的变量做乱序处理，也不会将该值保存在寄存器中，而是以内存中的为准。
	以此保证变量在线程间的可见性同步。

### volatile写的内存语义：
	
	当写一个 volatile 变量时，JMM 会把该线程对应的本地内存中的共享变量值刷新到主内存。
	
### volatile读的内存语义：

	当读一个 volatile 变量时，JMM 会把该线程对应的本地内存置为无效。线程接下来将从主内存中读取共享变量。



	
